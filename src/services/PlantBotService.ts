import { Plant } from '../data/plantsData';

export class PlantBotService {
  private plants: Plant[];

  constructor(plants: Plant[]) {
    this.plants = plants;
  }

  getBotResponse(userMessage: string): string {
    const message = userMessage.toLowerCase().trim();
    
    // ุงูุชุญูู ูู ุงูุณูุงูุงุช ูุงููุฏุงุน
    if (this.isGreeting(message)) {
      return 'ุฃููุงู ูุณููุงู! ๐ฑ ุฃูุง ููุง ููุณุงุนุฏุชู ูู ูู ูุง ูุชุนูู ุจุงููุจุงุชุงุช. ููููู ุฃู ุชุณุฃููู ุนู:\n\nโข ูุนูููุงุช ุนู ูุจุชุฉ ูุนููุฉ\nโข ุทุฑู ุงูุนูุงูุฉ ุจุงููุจุงุชุงุช\nโข ุญู ูุดุงูู ุงููุจุงุชุงุช\nโข ุงููุจุงุชุงุช ุงูููุงุณุจุฉ ูููุจุชุฏุฆูู\nโข ุงููุจุงุชุงุช ุงูุฏุงุฎููุฉ ุฃู ุงูุฎุงุฑุฌูุฉ\nโข ุงูุจุฐูุฑ ูุงูุฒุฑุงุนุฉ\n\nูุง ุงูุฐู ุชูุฏ ูุนุฑูุชูุ ๐ฟ';
    }

    if (this.isFarewell(message)) {
      return 'ูุฏุงุนุงู! ๐ ุฃุชููู ุฃู ุฃููู ูุฏ ุณุงุนุฏุชู. ูุง ุชุชุฑุฏุฏ ูู ุงูุนูุฏุฉ ุฅุฐุง ูุงู ูุฏูู ุฃู ุงุณุชูุณุงุฑ ุขุฎุฑ ุนู ุงููุจุงุชุงุช! ๐บ';
    }

    // ุงูุจุญุซ ุนู ุงููุจุงุชุงุช
    const foundPlant = this.findPlantByName(message);
    if (foundPlant) {
      return this.getDetailedPlantInfo(foundPlant);
    }

    // ูุนุงูุฌุฉ ูุดุงูู ุงููุจุงุชุงุช
    const problemSolution = this.getPlantProblemSolution(message);
    if (problemSolution) {
      return problemSolution;
    }

    // ุงุณุชูุณุงุฑุงุช ุนุงูุฉ ุนู ุงููุฆุงุช
    if (this.isAsking(message, ['ุฏุงุฎูู', 'ุฏุงุฎููุฉ', 'ููุฒููุฉ', 'ุจูุช', 'ุฌูุง', 'ุงูุจูุช'])) {
      const indoorPlants = this.plants.filter(p => p.category === 'indoor');
      return this.getCategoryResponse('ุงููุจุงุชุงุช ุงูุฏุงุฎููุฉ', indoorPlants);
    }

    if (this.isAsking(message, ['ุฎุงุฑุฌู', 'ุฎุงุฑุฌูุฉ', 'ุญุฏููุฉ', 'ุญุฏุงุฆู', 'ุจุฑุง', 'ุงูุญุฏููุฉ'])) {
      const outdoorPlants = this.plants.filter(p => p.category === 'outdoor');
      return this.getCategoryResponse('ุงููุจุงุชุงุช ุงูุฎุงุฑุฌูุฉ', outdoorPlants);
    }

    if (this.isAsking(message, ['ุจุฐูุฑ', 'ุจุฐุฑุฉ', 'ุฒุฑุงุนุฉ', 'ุจุฐุฑ', 'ุงุฒุฑุน'])) {
      const seeds = this.plants.filter(p => p.category === 'seed');
      return this.getCategoryResponse('ุงูุจุฐูุฑ', seeds);
    }

    // ูุตุงุฆุญ ุงูุนูุงูุฉ ุงูุนุงูุฉ
    if (this.isAsking(message, ['ุนูุงูุฉ', 'ุฑู', 'ุชุณููุฏ', 'ุงูุชูุงู', 'ููู', 'ุงูุด', 'ุดู', 'ุงุนุชูู'])) {
      return this.getGeneralCareAdvice();
    }

    // ูุจุงุชุงุช ูููุจุชุฏุฆูู
    if (this.isAsking(message, ['ูุจุชุฏุฆ', 'ุณูู', 'ุณููุฉ', 'ุฃูู', 'ุงูู', 'ุงุจุฏุฃ', 'ุฌุฏูุฏ'])) {
      const easyPlants = this.plants.filter(p => p.difficulty === 'ุณูู');
      return this.getEasyPlantsResponse(easyPlants);
    }

    // ุงูุจุญุซ ุจุงููููุงุช ุงูููุชุงุญูุฉ
    const relatedPlants = this.searchPlantsByKeywords(message);
    if (relatedPlants.length > 0) {
      return this.getSearchResults(relatedPlants, message);
    }

    // ุงูุฑุฏ ุงูุงูุชุฑุงุถู
    return 'ุฃุนุชุฐุฑุ ูู ุฃููู ุณุคุงูู ุชูุงูุงู. ๐ค\n\nููููู ุฃู ุชุณุฃููู ุนู:\nโข ุฃุณูุงุก ุงููุจุงุชุงุช ุงูููุฌูุฏุฉ ูุฏููุง\nโข ุทุฑู ุงูุนูุงูุฉ ุจูุจุชุฉ ูุนููุฉ\nโข ุญู ูุดุงูู ุงููุจุงุชุงุช (ุฃูุฑุงู ุตูุฑุงุกุ ุฐุจููุ ูุบูุฑูุง)\nโข ุงููุจุงุชุงุช ุงูููุงุณุจุฉ ูููุจุชุฏุฆูู\nโข ุงููุฑู ุจูู ุงููุจุงุชุงุช ุงูุฏุงุฎููุฉ ูุงูุฎุงุฑุฌูุฉ\n\nุญุงูู ุฃู ุชููู ุฃูุซุฑ ุชุญุฏูุฏุงู ูู ุณุคุงูู! ๐ฟ';
  }

  private getPlantProblemSolution(message: string): string | null {
    // ูุดุงูู ุงูุฃูุฑุงู ุงูุตูุฑุงุก
    if (this.isAsking(message, ['ุฃูุฑุงู ุตูุฑุงุก', 'ุงุตูุฑุงุฑ', 'ุงุตูุฑุช', 'ุตูุฑุงุก', 'ุตูุฑุง', 'ุตุงูุฑุฉ'])) {
      return '๐ **ุงูุฃูุฑุงู ุงูุตูุฑุงุก - ุงูุฃุณุจุงุจ ูุงูุญููู:**\n\n' +
             '**ุงูุฃุณุจุงุจ ุงูุดุงุฆุนุฉ:**\n' +
             'โข ุฅูุฑุงุท ูู ุงูุฑู (ุงูุณุจุจ ุงูุฃูุซุฑ ุดููุนุงู)\n' +
             'โข ููุต ูู ุงูุถูุก\n' +
             'โข ููุต ุงูุชุบุฐูุฉ\n' +
             'โข ูุดุงูู ูู ุงูุชุตุฑูู\n' +
             'โข ุชูุฏู ุทุจูุนู ูู ุงูุนูุฑ\n\n' +
             '**ุงูุญููู:**\n' +
             'โข ููู ูู ูููุฉ ุงูุฑู ูุงุชุฑูู ุงูุชุฑุจุฉ ุชุฌู ุจูู ุงูุฑูุงุช\n' +
             'โข ุงูููู ุงููุจุชุฉ ูููุงู ุฃูุซุฑ ุฅุถุงุกุฉ\n' +
             'โข ุงุณุชุฎุฏูู ุณูุงุฏ ูุชูุงุฒู ูู ุดูุฑูู\n' +
             'โข ุชุฃูุฏู ูู ูุฌูุฏ ุซููุจ ุชุตุฑูู ูู ุงูุฃุตูุต\n' +
             'โข ุงูุทุนู ุงูุฃูุฑุงู ุงูุตูุฑุงุก ูุชุดุฌูุน ุงูููู ุงูุฌุฏูุฏ\n\n' +
             'ุงุฐูุฑู ุงุณู ุงููุจุชุฉ ููุญุตูู ุนูู ูุตุงุฆุญ ูุญุฏุฏุฉ! ๐ฑ';
    }

    // ูุดุงูู ุงูุฐุจูู
    if (this.isAsking(message, ['ุฐุงุจูุฉ', 'ุฐุจูุช', 'ุฐุจูู', 'ูุงูุชุฉ', 'ููุชุฉ', 'ุชููุช'])) {
      return '๐ **ุฐุจูู ุงููุจุงุชุงุช - ุงูุฃุณุจุงุจ ูุงูุญููู:**\n\n' +
             '**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ:**\n' +
             'โข ุฌูุงู ุงูุชุฑุจุฉ ุงูุดุฏูุฏ\n' +
             'โข ุฅูุฑุงุท ูู ุงูุฑู ูุชุนูู ุงูุฌุฐูุฑ\n' +
             'โข ุตุฏูุฉ ุงูุงูุชูุงู\n' +
             'โข ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุบูุฑ ููุงุณุจุฉ\n' +
             'โข ููุต ุงูุฑุทูุจุฉ\n\n' +
             '**ุงูุญููู:**\n' +
             'โข ุงุฎุชุจุฑู ุฑุทูุจุฉ ุงูุชุฑุจุฉ ุจุฅุตุจุนู\n' +
             'โข ุฅุฐุง ูุงูุช ุฌุงูุฉ: ุงุณูููุง ุชุฏุฑูุฌูุงู\n' +
             'โข ุฅุฐุง ูุงูุช ูุจููุฉ: ุชูููู ุนู ุงูุฑู ูุญุณูู ุงูุชูููุฉ\n' +
             'โข ุงุจุนุฏููุง ุนู ุงูุชูุงุฑุงุช ุงูููุงุฆูุฉ\n' +
             'โข ุฑุดู ุงูุฃูุฑุงู ุจุงููุงุก ูุฒูุงุฏุฉ ุงูุฑุทูุจุฉ\n' +
             'โข ูููู ุตุจูุฑุฉุ ูุฏ ุชุญุชุงุฌ ููุช ููุชุนุงูู\n\n' +
             'ุฃุฎุจุฑููู ุนู ููุน ุงููุจุชุฉ ููุชู ุจุฏุฃุช ุงููุดููุฉ! ๐ฟ';
    }

    // ูุดุงูู ุงูููู ุงูุจุทูุก
    if (this.isAsking(message, ['ูุง ุชููู', 'ููู ุจุทูุก', 'ูุด ุทุงูุนุฉ', 'ูุง ุชูุจุฑ', 'ุตุบูุฑุฉ'])) {
      return '๐ฑ **ุจุทุก ุงูููู - ุงูุฃุณุจุงุจ ูุงูุญููู:**\n\n' +
             '**ุฃุณุจุงุจ ุจุทุก ุงูููู:**\n' +
             'โข ููุต ุงูุถูุก\n' +
             'โข ููุต ุงูุชุบุฐูุฉ\n' +
             'โข ุฃุตูุต ุตุบูุฑ ุฌุฏุงู\n' +
             'โข ููุณู ุงูุฎููู (ุงูุดุชุงุก)\n' +
             'โข ุชุฑุจุฉ ูููุฑุฉ ุฃู ูุถุบูุทุฉ\n\n' +
             '**ููููุฉ ุชุญููุฒ ุงูููู:**\n' +
             'โข ุงูููููุง ูููุงู ุฃูุซุฑ ุฅุถุงุกุฉ\n' +
             'โข ุงุณุชุฎุฏูู ุณูุงุฏ ูููุจุงุชุงุช ุงูุฎุถุฑุงุก\n' +
             'โข ุงูููููุง ูุฃุตูุต ุฃูุจุฑ ุฅุฐุง ุงูุชูุฃุช ุงูุฌุฐูุฑ\n' +
             'โข ุบูุฑู ุงูุชุฑุจุฉ ุจุฃุฎุฑู ุบููุฉ ููููููุฉ\n' +
             'โข ูููู ุตุจูุฑุฉ ูู ูุตู ุงูุดุชุงุก\n\n' +
             'ุงููุจุงุชุงุช ุชุญุชุงุฌ ููุช! ุงุฐูุฑู ููุน ุงููุจุชุฉ ูููุณุงุนุฏุฉ ุฃูุซุฑ ๐ฟ';
    }

    // ูุดุงูู ุงูุญุดุฑุงุช
    if (this.isAsking(message, ['ุญุดุฑุงุช', 'ููู', 'ุฐุจุงุจ', 'ุญุดุฑุฉ', 'ุฏูุฏ', 'ุนูุฏูุง ุญุดุฑุงุช'])) {
      return '๐ **ูุดุงูู ุงูุญุดุฑุงุช ูุงูุขูุงุช:**\n\n' +
             '**ุงูุญุดุฑุงุช ุงูุดุงุฆุนุฉ:**\n' +
             'โข ุงูููู: ูุฏ ูุฏู ุนูู ูุฌูุฏ ุงููู\n' +
             'โข ุงูุฐุจุงุจ ุงูุฃุจูุถ: ูุชุฌูุน ุชุญุช ุงูุฃูุฑุงู\n' +
             'โข ุงููู: ุญุดุฑุงุช ุตุบูุฑุฉ ุฎุถุฑุงุก ุฃู ุณูุฏุงุก\n' +
             'โข ุงูุนููุจูุช ุงูุฃุญูุฑ: ุฎููุท ุฑููุนุฉ\n\n' +
             '**ุงูุญููู ุงูุทุจูุนูุฉ:**\n' +
             'โข ุงุบุณูู ุงูุฃูุฑุงู ุจูุงุก ูุตุงุจูู ุทุจูุนู\n' +
             'โข ุฑุดู ุจูุญููู ุงูุซูู ูุงููููู\n' +
             'โข ุงุณุชุฎุฏูู ุฒูุช ุงูููู\n' +
             'โข ุถุนู ุฃูุฑุงู ุงููุนูุงุน ุญูู ุงููุจุชุฉ\n' +
             'โข ุญุณูู ุงูุชูููุฉ ููููู ุงูุฑุทูุจุฉ\n\n' +
             '**ููุญุงูุงุช ุงูุดุฏูุฏุฉ:**\n' +
             'โข ุงุณุชุฎุฏูู ูุจูุฏ ุญุดุฑู ุนุถูู\n' +
             'โข ุงุนุฒูู ุงููุจุชุฉ ุนู ุจุงูู ุงููุจุงุชุงุช\n\n' +
             'ูุตูููู ุงูุญุดุฑุงุช ุฃูุซุฑ ูููุณุงุนุฏุฉ ุงููุญุฏุฏุฉ! ๐ฟ';
    }

    return null;
  }

  private isGreeting(message: string): boolean {
    const greetings = ['ูุฑุญุจุง', 'ุฃููุง', 'ุงูุณูุงู', 'ุตุจุงุญ', 'ูุณุงุก', 'ููุง', 'ุงูููู', 'ูุงู', 'ุงูู'];
    return greetings.some(greeting => message.includes(greeting));
  }

  private isFarewell(message: string): boolean {
    const farewells = ['ูุฏุงุน', 'ุจุงู', 'ุดูุฑุง', 'ุชุณูู', 'ุงููู ูุนุทูู', 'ุงูุชููุช', 'ูุน ุงูุณูุงูุฉ', 'ูุณููู'];
    return farewells.some(farewell => message.includes(farewell));
  }

  private isAsking(message: string, keywords: string[]): boolean {
    return keywords.some(keyword => message.includes(keyword));
  }

  private findPlantByName(message: string): Plant | null {
    return this.plants.find(plant => 
      message.includes(plant.name.toLowerCase()) ||
      (plant.scientificName && message.includes(plant.scientificName.toLowerCase()))
    ) || null;
  }

  private searchPlantsByKeywords(message: string): Plant[] {
    return this.plants.filter(plant => 
      plant.shortDescription.toLowerCase().includes(message) ||
      plant.fullDescription.toLowerCase().includes(message) ||
      plant.careInstructions.toLowerCase().includes(message) ||
      (plant.benefits && plant.benefits.some(benefit => benefit.toLowerCase().includes(message)))
    );
  }

  private getDetailedPlantInfo(plant: Plant): string {
    return `๐ฟ **${plant.name}**\n\n` +
           `๐ **ุงููุตู:** ${plant.shortDescription}\n\n` +
           `๐ท๏ธ **ุงูููุน:** ${this.getCategoryName(plant.category)}\n` +
           `๐ฌ **ุงูุงุณู ุงูุนููู:** ${plant.scientificName || 'ุบูุฑ ูุชููุฑ'}\n` +
           `๐ **ุงูููุทู ุงูุฃุตูู:** ${plant.origin || 'ุบูุฑ ูุชููุฑ'}\n` +
           `๐ **ูุณุชูู ุงูุตุนูุจุฉ:** ${plant.difficulty || 'ุบูุฑ ูุญุฏุฏ'}\n\n` +
           `๐ง **ุงูุฑู:** ${plant.wateringFrequency || 'ุบูุฑ ูุญุฏุฏ'}\n` +
           `โ๏ธ **ุงูุฅุถุงุกุฉ:** ${plant.sunlight || 'ุบูุฑ ูุญุฏุฏ'}\n` +
           `๐ก๏ธ **ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ:** ${plant.temperature || 'ุบูุฑ ูุญุฏุฏ'}\n` +
           `๐จ **ุงูุฑุทูุจุฉ:** ${plant.humidity || 'ุบูุฑ ูุญุฏุฏ'}\n\n` +
           `๐ฑ **ุชุนูููุงุช ุงูุนูุงูุฉ:**\n${plant.careInstructions}\n\n` +
           (plant.benefits ? `โจ **ุงูููุงุฆุฏ:**\n${plant.benefits.map(benefit => `โข ${benefit}`).join('\n')}\n\n` : '') +
           (plant.commonProblems ? `โ๏ธ **ูุดุงูู ุดุงุฆุนุฉ:**\n${plant.commonProblems.map(problem => `โข ${problem}`).join('\n')}` : '');
  }

  private getCategoryResponse(categoryName: string, plants: Plant[]): string {
    if (plants.length === 0) {
      return `ูุนุชุฐุฑุ ูุง ุชูุฌุฏ ูุจุงุชุงุช ูู ูุฆุฉ ${categoryName} ุญุงููุงู.`;
    }

    return `๐ฟ **${categoryName}** (${plants.length} ููุน)\n\n` +
           plants.map(plant => `โข **${plant.name}**: ${plant.shortDescription}`).join('\n\n') +
           '\n\nุงุฎุชุฑ ุงุณู ุฃู ูุจุชุฉ ููุญุตูู ุนูู ูุนูููุงุช ููุตูุฉ ุนููุง! ๐ฑ';
  }

  private getEasyPlantsResponse(plants: Plant[]): string {
    if (plants.length === 0) {
      return 'ุฌููุน ุงููุจุงุชุงุช ูุฏููุง ุชุญุชุงุฌ ุฅูู ุนูุงูุฉ ุฎุงุตุฉุ ููู ูููููู ูุณุงุนุฏุชู ูู ุงุฎุชูุงุฑ ุงูุฃูุณุจ!';
    }

    return `๐ฑ **ุงููุจุงุชุงุช ุงูููุงุณุจุฉ ูููุจุชุฏุฆูู:**\n\n` +
           plants.map(plant => `โข **${plant.name}**: ${plant.shortDescription}`).join('\n\n') +
           '\n\nูุฐู ุงููุจุงุชุงุช ุณููุฉ ุงูุนูุงูุฉ ููุซุงููุฉ ูููุจุชุฏุฆูู! ๐';
  }

  private getSearchResults(plants: Plant[], query: string): string {
    return `๐ **ูุชุงุฆุฌ ุงูุจุญุซ ุนู "${query}":**\n\n` +
           plants.slice(0, 3).map(plant => `โข **${plant.name}**: ${plant.shortDescription}`).join('\n\n') +
           (plants.length > 3 ? `\n\n... ูุฌุฏุช ${plants.length - 3} ูุชุงุฆุฌ ุฃุฎุฑู` : '') +
           '\n\nุงุณุฃู ุนู ุฃู ูุจุชุฉ ููุญุตูู ุนูู ุชูุงุตูู ุฃูุซุฑ! ๐ฟ';
  }

  private getGeneralCareAdvice(): string {
    return `๐ฟ **ูุตุงุฆุญ ุนุงูุฉ ููุนูุงูุฉ ุจุงููุจุงุชุงุช:**\n\n` +
           `๐ง **ุงูุฑู:**\nโข ุชุญูู ูู ุฑุทูุจุฉ ุงูุชุฑุจุฉ ูุจู ุงูุฑู\nโข ุชุฌูุจ ุงูุฅูุฑุงุท ูู ุงูุฑู\nโข ุงุณุชุฎุฏู ูุงุก ุจุฏุฑุฌุฉ ุญุฑุงุฑุฉ ุงูุบุฑูุฉ\n\n` +
           `โ๏ธ **ุงูุฅุถุงุกุฉ:**\nโข ูุนุธู ุงููุจุงุชุงุช ุชุญุจ ุงูุถูุก ุงูุณุงุทุน ุบูุฑ ุงููุจุงุดุฑ\nโข ุชุฌูุจ ุฃุดุนุฉ ุงูุดูุณ ุงููุจุงุดุฑุฉ ูููุจุงุชุงุช ุงูุฏุงุฎููุฉ\n\n` +
           `๐ฑ **ุงูุชุณููุฏ:**\nโข ุงุณุชุฎุฏู ุงูุฃุณูุฏุฉ ุฎูุงู ููุณู ุงูููู\nโข ุชุฌูุจ ุงูุชุณููุฏ ูู ุงูุดุชุงุก\n\n` +
           `โ๏ธ **ุงูุชูููู:**\nโข ูู ุจุฅุฒุงูุฉ ุงูุฃูุฑุงู ุงูููุชุฉ ุฃู ุงููุฑูุถุฉ\nโข ููู ุงููุจุงุชุงุช ูุชุดุฌูุน ุงูููู ุงูุฌุฏูุฏ\n\n` +
           `ูู ุชุฑูุฏ ูุตุงุฆุญ ูุญุฏุฏุฉ ููุจุชุฉ ูุนููุฉุ ุงุฐูุฑ ุงุณููุง! ๐บ`;
  }

  private getCategoryName(category: string): string {
    switch (category) {
      case 'indoor': return 'ูุจุงุชุงุช ุฏุงุฎููุฉ';
      case 'outdoor': return 'ูุจุงุชุงุช ุฎุงุฑุฌูุฉ';
      case 'seed': return 'ุจุฐูุฑ';
      default: return 'ุบูุฑ ูุญุฏุฏ';
    }
  }
}
